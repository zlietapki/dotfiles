# Keybindings
# https://wiki.hyprland.org/Configuring/Binds/
# https://wiki.hypr.land/Configuring/Binds/#submaps
# regex notation Google RE2 https://github.com/google/re2/wiki/Syntax

$scriptDir = ~/.config/hypr/scripts
$setUSLayout = hyprctl switchxkblayout $(hyprctl -j devices | jq -r '.keyboards | .[] | select(.main == true) | .name') 0
# debug actions
bind = SUPER_ALT, 1, exec, export > /tmp/hypr_envs # all exported env vars

# load custom machine config
source = ~/.config/hypr/$MACHINE_ID/binds.conf # MACHINE_ID from /etc/environment

# no gaps когда одно окно https://wiki.hyprland.org/Configuring/Workspace-Rules/#smart-gaps
# должно быть до всех правил про workspace
workspace = w[tv1], gapsout:0, gapsin:0
workspace = f[1], gapsout:0, gapsin:0
windowrule {
  name = windowrule-1
  border_size = 0
  match:float = 0
  match:workspace = w[tv1]
}

windowrule {
  name = windowrule-2
  border_size = 0
  match:float = 0
  match:workspace = f[1]
}


bindd = SUPER, 1, Switch to workspace, workspace, 1
bindd = SUPER, 2, Switch to workspace, workspace, 2
bindd = SUPER, 3, Switch to workspace, workspace, 3
bindd = SUPER, 4, Switch to workspace, workspace, 4
bindd = SUPER, 5, Switch to workspace, workspace, 5
bindd = SUPER, 6, Switch to workspace, workspace, 6
bindd = SUPER, 7, Switch to workspace, workspace, 7
bindd = SUPER, 8, Switch to workspace, workspace, 8
bindd = SUPER, 9, Switch to workspace, workspace, 9
bindd = SUPER, 0, Switch to workspace, workspace, 10

bindd = CTRL, grave, Switch to terminal workspace, togglespecialworkspace, terminal
bindd = SUPER_CTRL, grave, Move to terminal workspace, movetoworkspacesilent, special:terminal

bindd = , Pause, Toggle notes worspace, togglespecialworkspace, codium
bindd = SUPER_CTRL, Pause, Move to notes worspace, movetoworkspacesilent, special:codium

bindd = , Scroll_Lock, Toggle telegram worspace, togglespecialworkspace, telegram
bindd = SUPER_CTRL, Scroll_Lock, Move to telegram workspace, movetoworkspacesilent, special:telegram

bindd = SUPER, F1, Toggle throne worspace, togglespecialworkspace, throne
bindd = SUPER_CTRL, F1, Move to throne worspace, movetoworkspacesilent, special:throne

bindd = SUPER_CTRL, 1, Move to workspace, movetoworkspacesilent, 1
bindd = SUPER_CTRL, 2, Move to workspace, movetoworkspacesilent, 2
bindd = SUPER_CTRL, 3, Move to workspace, movetoworkspacesilent, 3
bindd = SUPER_CTRL, 4, Move to workspace, movetoworkspacesilent, 4
bindd = SUPER_CTRL, 5, Move to workspace, movetoworkspacesilent, 5
bindd = SUPER_CTRL, 6, Move to workspace, movetoworkspacesilent, 6
bindd = SUPER_CTRL, 7, Move to workspace, movetoworkspacesilent, 7
bindd = SUPER_CTRL, 8, Move to workspace, movetoworkspacesilent, 8
bindd = SUPER_CTRL, 9, Move to workspace, movetoworkspacesilent, 9
bindd = SUPER_CTRL, 0, Move to workspace, movetoworkspacesilent, 10

################
# Common binds #
################
# Switch windows # windows like switch
bind = ALT, Tab, cyclenext, prev
bind = ALT, Tab, exec, $scriptDir/alt_tab_press.sh
bind = ALT_SHIFT, Tab, cyclenext,
bind = ALT_SHIFT, Tab, exec, $scriptDir/alt_tab_press.sh
bindrt = ALT, ALT_L, exec, $scriptDir/alt_release.sh
bindrt = SHIFT, SHIFT_L, exec, $scriptDir/alt_release.sh

# Move/Resize windows with WIN + LMB/RMB dragging
bindm = SUPER, mouse:272, movewindow
bindm = SUPER, mouse:273, resizewindow

bindd = ALT, F4, Kill window on focus, exec, hyprctl dispatch killactive ""
bindd = , F11, Toggle fullscreen, fullscreen, 0
bindd = ALT, return, toggle maximize. keeps gaps and bars, fullscreen, 1
bindd = SUPER, delete, Exit hyperland, exec, hyprctl dispatch exit
bindd = SUPER, F, Toggle window on focus float, togglefloating
bindd = SUPER, L, Lock screen, exec, swaylock
bindd = CTRL_ALT, L, Lock screen, exec, swaylock
bindd = CTRL_ALT, DELETE, Logout or restart, exec, pkill -x wlogout || wlogout --buttons-per-row 4 --margin 0 --layout "$HOME/.config/wlogout/layout" --css "$HOME/.config/wlogout/style.css" --protocol layer-shell

bindd = , Print, Make Screenshot, exec, grim -g "$(slurp)" - | swappy -f -
bindd = ALT, Print, Copy pixel color, exec, hyprpicker --autocopy --no-fancy

# Audio
$getVolume = wpctl get-volume @DEFAULT_AUDIO_SINK@ | sed "s/Volume: //" | sed "s/0\.//" | tr --delete "."
bindl  = , XF86AudioMicMute, exec, wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle
bindl  = , XF86AudioMute, exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bindel = , XF86AudioRaiseVolume, exec, bash -c 'v=$($getVolume); [[ $v -lt 150 ]] && ((v += 10)) && wpctl set-volume @DEFAULT_AUDIO_SINK@ 10%+; echo $v > $WOBSOCK'
bindel = , XF86AudioLowerVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 10%- && echo $($getVolume) > $WOBSOCK
bindl  = , XF86AudioPlay, exec, playerctl play-pause
bindl  = , XF86AudioPause, exec, playerctl play-pause
bindl  = , XF86AudioNext, exec, playerctl next
bindl  = , XF86AudioPrev, exec, playerctl previous

bindd = SUPER, LEFT, Move focus left, movefocus, l
bindd = SUPER, RIGHT, Move focus right, movefocus, r
bindd = SUPER, UP, Move focus up, movefocus, u
bindd = SUPER, DOWN, Move focus down, movefocus, d

bindd = SUPER_CTRL, LEFT, Move window left, movewindow, l
bindd = SUPER_CTRL, RIGHT, Move window right, movewindow, r
bindd = SUPER_CTRL, UP, Move window up, movewindow, u
bindd = SUPER_CTRL, DOWN, Move window down, movewindow, d

#  WIN + CTRL + Cursor
binde = SUPER_ALT, RIGHT, resizeactive, 30 0
binde = SUPER_ALT, LEFT, resizeactive, -30 0
binde = SUPER_ALT, UP, resizeactive, 0 -30
binde = SUPER_ALT, DOWN, resizeactive, 0 30

#########################
# Application shortcuts #
#########################

$getProxyPAC = base64 -w0 ~/proxy.pac
bindd = SUPER, B, Google chrome, exec, uwsm app -- google-chrome-stable --class="google-chrome" --proxy-pac-url='data:application/x-javascript-config;base64,'$($getProxyPAC)
bindd = SUPER_ALT, B, Brave browser, exec, uwsm app -- brave --proxy-server="socks5://127.0.0.1:2080"

bindd = CTRL, ESCAPE, Htop, exec, hypr_start_move_kill 'kitty --class=sysmonitor htop' sysmonitor
bindd = SUPER, SUPER_R, App launcher, exec, pkill -x anyrun || anyrun --plugins libapplications.so
bindd = ALT, Space, App launcher, exec, pkill -x anyrun || anyrun --plugins libapplications.so
bindd = SUPER, Space, App launcher, exec, pkill -x anyrun || anyrun --plugins libapplications.so
bindd = ALT, F2, Lunch asddoc, exec, asddoc_rofi -e 'code --ozone-platform-hint=auto' && hypr_activate_ws_if_exists special:codium

bindd = SUPER, T, Lunch foot terminal, exec, foot
bindd = SUPER, W, Window info, exec, hyprctl activewindow -j | jq --sort-keys >| /tmp/window_info && foot sh -c 'jq --color-output < /tmp/window_info | less --RAW-CONTROL-CHARS'

#####################
# Special workspace #
#####################
# у workspace при rounding:false начинает просвечивать верхняя грань htop
workspace = special:terminal, rounding:true, gapsout:300 150 -4, on-created-empty: ghostty --class=my.terminal
workspace = special:codium, rounding:true, gapsout:300 100 50, border:false, on-created-empty: code --ozone-platform-hint=auto
workspace = special:telegram, rounding:true, gapsout:70, border:false, on-created-empty: uwsm app -- Telegram
workspace = special:throne, rounding:true, gapsout:50, border:false, on-created-empty: uwsm app -- throne

# открытые приложения переносить на свои воркспейсы
windowrule {
  name = windowrule-3
  workspace = special:telegram
  match:class = ^org.telegram.desktop$
  match:initial_title = ^Telegram$ # main window > special:telegram
}


# telegram viewer
windowrule {
  name = windowrule-4
  float = on
  size = 1920 1047
  move = (0) (0)
  match:class = ^org.telegram.desktop$
  match:title = ^Media viewer$
}


# Network Manager applet connection editor
windowrule {
  name = windowrule-5
  float = on
  match:class = ^nm-connection-editor$
}


# htop
windowrule {
  name = windowrule-6
  float = on
  center = 1
  size = (monitor_w*0.75) (monitor_h*0.75)
  match:class = ^sysmonitor$
}

windowrule {
  name = windowrule-7
  rounding = 1
  match:class = ^sysmonitor$ # rounding 0 начинает просвечивать десктоп через вернюю грань на темном фоне
}


# qBittorrent
windowrule {
  name = windowrule-8
  float = on
  match:class = ^org.qbittorrent.qBittorrent$
  match:title = '^[^q][^B][^i][^t]' # основное окно имеет title qBittorrent v5.1.2 - его не флоатить
}

windowrule {
  name = windowrule-9
  size = (monitor_w*0.65) (monitor_h*0.65)
  center = 1
  match:class = ^org.qbittorrent.qBittorrent$
}


bindd = SUPER, tab, Show notifications, exec, swaync-client --toggle-panel --skip-wait
