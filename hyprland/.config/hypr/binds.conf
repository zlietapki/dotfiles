# Keybindings
# https://wiki.hyprland.org/Configuring/Binds/
# https://wiki.hypr.land/Configuring/Binds/#submaps
# regex notation Google RE2 https://github.com/google/re2/wiki/Syntax

$scriptDir = ~/.config/hypr/scripts
$setUSLayout = hyprctl switchxkblayout $(hyprctl -j devices | jq -r '.keyboards | .[] | select(.main == true) | .name') 0
# debug actions
bind = SUPER_ALT, 1, exec, export > /tmp/hypr_envs # all exported env vars

# load custom machine config
source = ~/.config/hypr/$MACHINE_ID/binds.conf # MACHINE_ID from /etc/environment

# no gaps когда одно окно https://wiki.hyprland.org/Configuring/Workspace-Rules/#smart-gaps
# должно быть до всех правил про workspace
workspace = w[tv1], gapsout:0, gapsin:0
workspace = f[1], gapsout:0, gapsin:0
windowrule = bordersize 0, floating:0, onworkspace:w[tv1]
windowrule = bordersize 0, floating:0, onworkspace:f[1]

bind = ALT, 1, workspace, 1
bind = ALT, 2, workspace, 2
bind = ALT, 3, workspace, 3
bind = ALT, 4, workspace, 4
bind = ALT, 5, workspace, 5
bind = ALT, 6, workspace, 6
bind = ALT, 7, workspace, 7
bind = ALT, 8, workspace, 8
bind = ALT, 9, workspace, 9
bind = ALT, 0, workspace, 10

bind = CTRL, grave, togglespecialworkspace, terminal
bind = CTRL_ALT, grave, movetoworkspacesilent, special:terminal

bind = , Pause, togglespecialworkspace, codium
bind = CTRL, Pause, movetoworkspacesilent, special:codium

bind = SUPER, 1, togglespecialworkspace, throne
bind = SUPER_CTRL, 1, movetoworkspacesilent, special:throne

bind = , Scroll_Lock, togglespecialworkspace, telegram
bind = CTRL, Scroll_Lock, movetoworkspacesilent, special:telegram

bind = ALT, Scroll_Lock, togglespecialworkspace, band
bind = CTRL_ALT, Scroll_Lock, movetoworkspacesilent, special:band

bind = CTRL, 1, movetoworkspacesilent, 1
bind = CTRL, 2, movetoworkspacesilent, 2
bind = CTRL, 3, movetoworkspacesilent, 3
bind = CTRL, 4, movetoworkspacesilent, 4
bind = CTRL, 5, movetoworkspacesilent, 5
bind = CTRL, 6, movetoworkspacesilent, 6
bind = CTRL, 7, movetoworkspacesilent, 7
bind = CTRL, 8, movetoworkspacesilent, 8
bind = CTRL, 9, movetoworkspacesilent, 9
bind = CTRL, 0, movetoworkspacesilent, 10

################
# Common binds #
################
# Switch windows # windows like switch
bind = ALT, Tab, cyclenext, prev
bind = ALT, Tab, exec, $scriptDir/alt_tab_press.sh
bind = ALT_SHIFT, Tab, cyclenext,
bind = ALT_SHIFT, Tab, exec, $scriptDir/alt_tab_press.sh
bindrt = ALT, ALT_L, exec, $scriptDir/alt_release.sh
bindrt = SHIFT, SHIFT_L, exec, $scriptDir/alt_release.sh

# Move/Resize windows with WIN + LMB/RMB dragging
bindm = SUPER, mouse:272, movewindow
bindm = SUPER, mouse:273, resizewindow

bind = , F11, fullscreen, 0
bind = ALT, return, fullscreen, 1 # toggle maximize. keeps gaps and bars
bind = , Print, exec, grim -g "$(slurp)" - | swappy -f - # Screenshot
bind = ALT, Print, exec, grim - | swappy -f - # Screenshot full
bind = ALT, F4, exec, hyprctl dispatch killactive "" # killactive, kill the window on focus
bind = SUPER, delete, exec, hyprctl dispatch exit # exit hyperland
bind = SUPER, F, togglefloating, # toggle the window on focus to float
bind = SUPER, L, exec, swaylock # lock screen
bind = CTRL_ALT, L, exec, swaylock # lock screen
bind = CTRL_ALT, DELETE, exec, pkill -x wlogout || wlogout --buttons-per-row 4 --margin 0 --layout "$HOME/.config/wlogout/layout" --css "$HOME/.config/wlogout/style.css" --protocol layer-shell

# Audio
$getVolume = wpctl get-volume @DEFAULT_AUDIO_SINK@ | sed "s/Volume: //" | sed "s/0\.//" | tr --delete "."
bindl  = , XF86AudioMicMute, exec, wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle
bindl  = , XF86AudioMute, exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bindel = , XF86AudioRaiseVolume, exec, bash -c 'v=$($getVolume); [[ $v -lt 150 ]] && ((v += 10)) && wpctl set-volume @DEFAULT_AUDIO_SINK@ 10%+; echo $v > $WOBSOCK'
bindel = , XF86AudioLowerVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 10%- && echo $($getVolume) > $WOBSOCK
bindl  = , XF86AudioPlay, exec, playerctl play-pause
bindl  = , XF86AudioPause, exec, playerctl play-pause
bindl  = , XF86AudioNext, exec, playerctl next
bindl  = , XF86AudioPrev, exec, playerctl previous
# Move focus SUPER + arrows
bind = SUPER, LEFT, movefocus, l
bind = SUPER, RIGHT, movefocus, r
bind = SUPER, UP, movefocus, u
bind = SUPER, DOWN, movefocus, d
# Move window SUPER + ALT + Cursor
bind = SUPER_CTRL, LEFT, movewindow, l
bind = SUPER_CTRL, RIGHT, movewindow, r
bind = SUPER_CTRL, UP, movewindow, u
bind = SUPER_CTRL, DOWN, movewindow, d
# Resize window WIN + CTRL + Cursor
binde = SUPER_ALT, RIGHT, resizeactive, 30 0
binde = SUPER_ALT, LEFT, resizeactive, -30 0
binde = SUPER_ALT, UP, resizeactive, 0 -30
binde = SUPER_ALT, DOWN, resizeactive, 0 30

#########################
# Application shortcuts #
#########################

$getProxyPAC = base64 -w0 ~/proxy.pac
bind = SUPER, B, exec, uwsm app -- google-chrome-stable --class="google-chrome" --proxy-pac-url='data:application/x-javascript-config;base64,'$($getProxyPAC)
bind = SUPER_ALT, B, exec, uwsm app -- brave --proxy-server="socks5://127.0.0.1:2080"

bind = CTRL, ESCAPE, exec, hypr_start_move_kill 'kitty --class=sysmonitor htop' sysmonitor # htop
bindr = SUPER, SUPER_L, exec, pkill -x anyrun || uwsm app -- anyrun --plugins libapplications.so # menu app
bind = ALT, F2, exec, asddoc_rofi -e 'code --ozone-platform-hint=auto' && hypr_activate_ws_if_exists special:codium # asddoc

bind = SUPER, T, exec, foot
bind = CTRL_ALT, w, exec, hyprctl activewindow -j >| /tmp/window_info && foot sh -c 'jq --color-output < /tmp/window_info | less --RAW-CONTROL-CHARS' # window info

#####################
# Special workspace #
#####################
# у workspace при rounding:false начинает просвечивать верхняя грань htop
workspace = special:terminal, rounding:true, gapsout:300 150 -4, on-created-empty: uwsm app -- kitty --class terminal
workspace = special:codium, rounding:true, gapsout:300 100 50, border:false, on-created-empty: code --ozone-platform-hint=auto
workspace = special:telegram, rounding:true, gapsout:70, border:false, on-created-empty: uwsm app -- Telegram
workspace = special:band, rounding:true, gapsout:70, border:false, on-created-empty: band-desktop

# открытые приложения переносить на свои воркспейсы
windowrule = workspace special:telegram, class:^org.telegram.desktop$, initialTitle:^Telegram$ # main window > special:telegram
windowrule = workspace special:band, class:^Band$, title:^Band Desktop App$ # wb-band
windowrule = workspace 1, class:^google-chrome$ # chrome

# telegram viewer
windowrule = float, class:^org.telegram.desktop$, title:^Media viewer$
windowrule = size 1920 1047, class:^org.telegram.desktop$, title:^Media viewer$
windowrule = move 0 0, class:^org.telegram.desktop$, title:^Media viewer$

# Network Manager applet connection editor
windowrule = float, class:^nm-connection-editor$

# htop
windowrule = float, class:^sysmonitor$
windowrule = center 1, class:^sysmonitor$
windowrule = size 75% 75%, class:^sysmonitor$
windowrule = rounding 1, class:^sysmonitor$ # rounding 0 начинает просвечивать десктоп через вернюю грань на темном фоне

# qBittorrent
windowrule = float, class:^org.qbittorrent.qBittorrent$, title:'^[^q][^B][^i][^t]' # основное окно имеет title qBittorrent v5.1.2 - его не флоатить
windowrule = size 65% 65%, class:^org.qbittorrent.qBittorrent$
windowrule = center 1, class:^org.qbittorrent.qBittorrent$

bind = SUPER, tab, exec, swaync-client --toggle-panel --skip-wait # нотификации
bind = SUPER, Print, exec, hyprpicker --autocopy --no-fancy # копирование цвета точки
